
# phpBB 智慧離線閱讀器 - 使用手冊 & 開發文件

## 專案簡介

本專案旨在提供一個強大的 phpBB 論壇主題離線閱讀解決方案。它不僅能將線上論壇的長篇主題匯出為單一 JSON 檔案，還透過模擬的 AI 功能自動生成文章摘要，並提供一個功能豐富、高度個人化的前端閱讀介面。

使用者可以在完全離線的環境下，享受流暢的閱讀、搜尋、標註、篩選和筆記體驗。

---

## I. 使用者手冊

### 1. 快速開始

1.  **開啟閱讀器**：在專案中，找到 `offline_reader` 資料夾，用瀏覽器開啟裡面的 `reader.html` 檔案。
2.  **載入資料**：點擊頁面頂部的「選擇檔案」按鈕，選擇一個從論壇匯出的 `topic_xxxx.json` 檔案。
3.  **開始閱讀**：檔案載入後，文章內容便會顯示出來。

### 2. 介面功能詳解

#### 頂部控制列

*   **選擇檔案**：用於載入新的主題 JSON 檔案。
*   **跳轉樓層**：輸入文章的樓層號（例如 `2024`），按下「跳轉」按鈕，即可快速定位到該篇文章所在的頁面和位置。
*   **儲存變更**：點擊此按鈕，會將您在閱讀器中做的所有修改（如編輯摘要、新增標籤、標註文章）儲存成一個新的 `..._edited.json` 檔案，不會覆蓋原檔案。

#### 文章區域

*   **摘要 (可編輯)**：每篇文章頂部是由 AI 生成的摘要。**您可以直接點擊摘要文字進行修改**，您的修改將在按下「儲存變更」後被保存。
*   **標籤 (可篩選)**：摘要下方是文章的標籤。點擊任何一個標籤，可以篩選出所有包含該標籤的文章。
*   **作者 (可篩選)**：點擊作者的名字，可以篩選出該作者發布的所有文章。
*   **文章 ID (可連結)**：點擊 `(ID: xxxx)`，會在新分頁中開啟該篇文章在原始論壇上的連結。
*   **閱讀全文/收合文章**：點擊此按鈕可以展開或收合較長的文章內容。
*   **標註**：點擊「標註」按鈕，可以將該篇文章的背景變色，方便您做重點標記。
*   **新增自訂標籤**：在輸入框中輸入您自己的標籤，按下「新增」，即可為該文章添加個人化標籤。

#### 頁面底部控制項

*   **分頁列**：您可以透過「第一頁」、「上一頁」、「下一頁」、「最後一頁」按鈕來翻閱文章。
*   **跳頁**：在中間的輸入框中輸入頁碼，按下「跳頁」，可以直接跳轉到指定頁面。

#### 右下角浮動工具列

*   **字體縮放 (A+/A-)**：提供多達六級的字體大小調整。
*   **閱讀尺 (📏)**：開啟一個跟隨滑鼠的水平線，輔助您在閱讀長文時聚焦於特定行。
*   **深色模式 (🌙)**：在淺色與深色主題間切換，適應不同光線下的閱讀環境。
*   **回到頂部/直達底部 (↑/↓)**：快速在頁面頂部和底部之間移動。

---

## II. 開發與進階使用文件

### 1. 專案結構

*   `local_server/phpbb/`：本地 phpBB 伺服器環境，用於模擬真實論壇。
    *   `export_topic.php`：從本地論壇匯出主題資料的 PHP 腳本。
*   `offline_reader/`：前端離線閱讀器的所有檔案。
    *   `reader.html`：閱讀器主頁面。
    *   `js/main.js`：閱讀器的所有互動功能邏輯。
    *   `css/style.css`：閱讀器的主要自訂樣式。
*   `exported_data/`：存放從論壇匯出的原始 JSON 資料。
*   `summarize_posts.py`：核心的 Python 工具，用於處理摘要。
*   `README.md`：本文件。

### 2. 核心腳本使用指南

#### A. `export_topic.php` (匯出工具)

*   **用途**：從本地 phpBB 論壇中匯出指定 ID 的主題。
*   **使用**：確保本地伺服器 (如 XAMPP) 正在執行，然後在瀏覽器中訪問類似以下的 URL：
    `http://localhost/phpbb/export_topic.php?t=TOPIC_ID` (請將 `TOPIC_ID` 替換為實際的主題 ID)。
*   瀏覽器將會下載一個 `topic_TOPIC_ID.json` 檔案。

#### B. `summarize_posts.py` (摘要處理工具)

這是一個強大的命令列工具，提供三種模式來管理文章摘要。

*   **模式一：產生摘要 (generate)**
    *   **用途**：為 JSON 檔案中摘要為空或還是預設值的文章，自動產生新的摘要。
    *   **指令**：
        ```bash
        python3 summarize_posts.py generate /path/to/your/topic.json
        ```

*   **模式二：匯出摘要 (export)**
    *   **用途**：從一個已包含摘要（無論是 AI 生成或您手動修改）的 JSON 檔案中，將所有摘要提取並儲存到一個獨立的檔案中。
    *   **指令**：
        ```bash
        python3 summarize_posts.py export /path/to/source.json /path/to/summaries.json
        ```

*   **模式三：匯入摘要 (import)**
    *   **用途**：將之前匯出的摘要檔案，應用到一個新的、摘要不全的 JSON 檔案上。這在您重新從論壇匯出主題，但又想保留舊摘要時非常有用。
    *   **指令**：
        ```bash
        python3 summarize_posts.py import /path/to/summaries.json /path/to/target.json
        ```

### 3. 本地腳本環境設定

如果您想在自己的電腦上執行 `summarize_posts.py` 腳本，請遵循以下步驟設定環境：

**1. 安裝 Python**

*   請先確保您的電腦已安裝 Python 3.6 或更高版本。
*   您可以在終端機或命令提示字元中輸入 `python3 --version` 或 `python --version` 來檢查。
*   如果尚未安裝，請至 [Python 官方網站](https://www.python.org/downloads/) 下載並安裝。

**2. 安裝依賴函式庫**

*   本專案的所有 Python 腳本依賴都已記錄在 `requirements.txt` 檔案中。
*   請在終端機中，切換到本專案的根目錄下。
*   執行以下指令，即可一鍵安裝所有必要的函式庫：
    ```bash
    pip install -r requirements.txt
    ```

**3. 在 Google Cloud Shell 中執行 (推薦)**

由於此專案目前是「前端+後端」的整合架構，在 Cloud Shell 中執行是最方便的體驗方式。

*   **步驟 1**：登入 [Google Cloud Console](https://console.cloud.google.com/)。
*   **步驟 2**：點擊頂部導覽列中的「啟用 Cloud Shell」按鈕（一個終端機圖示）。
*   **步驟 3**：將本專案的檔案上傳到 Cloud Shell 環境中（可以使用 `upload` 按鈕或 `git clone`）。
*   **步驟 4**：在 Cloud Shell 終端機中，切換到專案根目錄。
*   **步驟 5**：執行以下指令安裝所有依賴函式庫：
    ```bash
    pip install -r requirements.txt
    ```
*   **步驟 6**：設定您的 Gemini API 金鑰和**連接埠**：
    ```bash
    export GEMINI_API_KEY="YOUR_API_KEY"
    export PORT=8080
    ```
*   **步驟 7**：啟動後端伺服器：
    ```bash
    python3 local_ai_service.py
    ```
*   **步驟 8**：伺服器啟動後，點擊 Cloud Shell 右上角的「**Web 預覽**」按鈕，並選擇「**在 8080 連接埠上預覽**」。
*   **步驟 9**：一個新的瀏覽器分頁將會開啟，直接顯示閱讀器介面，所有功能（包括 AI 功能）都已準備就緒，可以直接使用。


### 4. 本地環境設定 (替代方案)

如果您仍希望在本地電腦上分開執行，請遵循以下步驟：

**1. 安裝 Python**

*   請先確保您的電腦已安裝 Python 3.6 或更高版本。
*   您可以在終端機或命令提示字元中輸入 `python3 --version` 或 `python --version` 來檢查。
*   如果尚未安裝，請至 [Python 官方網站](https://www.python.org/downloads/) 下載並安裝。

**2. 安裝依賴函式庫**

*   本專案的所有 Python 腳本依賴都已記錄在 `requirements.txt` 檔案中。
*   請在終端機中，切換到本專案的根目錄下。
*   執行以下指令，即可一鍵安裝所有必要的函式庫：
    ```bash
    pip install -r requirements.txt
    ```

**3. 執行**
*   **啟動後端**：在一個終端機中，設定金鑰並啟動伺服器 `python3 local_ai_service.py`。
*   **開啟前端**：在瀏覽器中，直接打開 `offline_reader/reader.html` 檔案。

